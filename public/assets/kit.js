(function(a){a.KitTitle=function(d){var c=a.Component({id:"kit-title"},d);var g,b,f,h;function e(){b.click(function(){g.hide();f.show();h.val(g.attr("data-val")).focus()});h.blur(function(){var i=h.val();if(i){b.text(i);g.attr("data-val",i)}g.show();f.hide()})}c.oninit=function(){g=$(".k-kit-title-label");f=$(".k-kit-title-input");b=$(".k-kit-title-label h1");h=$("input",f);e()};return c.pub}})(Kitify);(function(a){a.NewItem=function(c){var b=a.Component({id:"newitem",fields:[{id:"newitem-name",prop:"name",label:"Product Name",required:true},{id:"newitem-quantity",prop:"quantity",label:"Quantity",validator:"positiveInteger",required:true},{id:"newitem-merchanturl",prop:"merchant_url",label:"Merchant URL",validator:"url",required:true},{id:"newitem-price",prop:"price",label:"Price",validator:"positiveNumeric",required:true},{id:"newitem-notes",prop:"notes",label:"Notes"}]},c);b.oninit=function(){var d=$("#kit").attr("data-id");var e=a.Form.setup({context:"#newitem",fields:b.options.fields,btns:{submit:"#kit-add-btn"}});$(e).bind("submit",function(f,g){g.slug=d;a.Data.save("/items",g,function(h){if(h&&h.success!==false){e.reset();h.price=parseFloat(h.price);$(a).trigger("item-created",[h])}})})};return b.pub}})(Kitify);(function(a){a.EditItem=function(f){var c=a.Component({id:"edititem",fields:[{id:"item-name",prop:"name",required:true},{id:"item-quantity",prop:"quantity",required:true},{id:"item-merchanturl",prop:"merchant_url",required:true},{id:"item-price",prop:"price",required:true},{id:"item-notes",prop:"notes"}]},f);var e,g;var b=['<tr class="k-items-editrow">','<td><input type="text" id="item-name" value="{{name}}" class="span3" required /></td>','<td><input type="number" id="item-quantity" value="{{quantity}}" class="span1" required /></td>','<td><input type="url" id="item-merchanturl" value="{{merchant_url}}" class="span4" required /></td>',"<td>",'<div class="input-prepend">','<span class="add-on">$</span>','<input type="number" id="item-price" value="{{price}}" class="span2" required />',"</div>","</td>","<td>",'<div class="k-kit-items-anchor">','<input type="text" id="item-notes" value="{{notes}}" class="span4" />','<div id="kit-items-savectrls" class="k-kit-ctrls k-corner-right">','<a href="javascript:void(0)" class="k-kit-ctrls-save btn small primary">save</a>','<a href="javascript:void(0)" class="k-kit-ctrls-cancel btn small">cancel</a>',"</div>","</div","</td>","</tr>"].join("");function d(h){var j=h.data("item");if(j){h.hide();g.detach();var k=$(a.template(b,j)).insertAfter(h);$("#kit-items-savectrls").show();var i=a.Form.setup({context:k,fields:c.options.fields,data:j,btns:{submit:".k-kit-ctrls-save"}});$(i).bind("submit",function(l,m){a.Data.save("/items/"+m.id,m,function(n){if(n&&n.success!==false){n.price=parseFloat(n.price);k.remove();$(a).trigger("item-updated",[n,h])}})});$(".k-kit-ctrls-cancel",k).click(function(){h.show();k.remove()})}}c.oninit=function(){e=$("#kit-items");g=$("#kit-items-editctrls");$(document).on("hover","#kit-items tbody tr",function(h){if(!$(this).hasClass("k-items-editrow")){if(h.type==="mouseenter"){g.appendTo($(".k-kit-items-anchor",this)).show()}else{g.hide()}}});$(".k-kit-ctrls-edit",g).click(function(){var h=$(this).parents("tr");if(h.length){d(h)}});$(".k-kit-ctrls-delete",g).click(function(){g.hide();var h=$(this).parents("tr");var i=h.attr("data-id");if(i){a.Data.del("/items/"+i,function(j){h.fadeOut(function(){g.appendTo("#kit");h.remove();$(a).trigger("item-deleted",[j.id])})})}})};return c.pub}})(Kitify);(function(a){a.Kit=function(k){var g=a.Component({id:"kit",components:{}},k),i=[];var j;var b='<tr class="k-kit-items-none"><td colspan="5">Start adding items above.</td></tr>';var h=['<tr data-id="{{id}}">','<td class="k-kit-items-name">{{name}}</td>',"<td>{{quantity}}</td>",'<td class="k-kit-items-url"><a href="{{merchant_url}}" target="_blank">{{merchant_url}}</a></td>',"<td>{{price}}</td>",'<td><div class="k-kit-items-anchor">{{notes}}</div></td>',"</tr>"].join("");function f(l){var m=$.extend(true,{},l);if(typeof l.price==="number"){m.price="$"+l.price.toFixed(2)}return m}function c(l,m){var n=f(m),o=a.template(h,n);$(o).appendTo(l).data("item",m)}function d(l,m){var n=f(m),o=a.template(h,n);l.replaceWith($(o).data("item",m))}function e(){var l=$("tbody",j).empty();if(!i.length){$("tbody",j).append(b)}else{$.each(i,function(m,n){n.price=parseFloat(n.price);c(l,n)})}}g.oninit=function(){g.pub.slug=$("#"+g.options.id).attr("data-id");j=$("#"+g.options.id+"-items");if($("#"+g.options.id).hasClass("editable")){$.each(g.options.components,function(l,m){m.init(g.pub)})}a.Data.get("/"+g.pub.slug+"/items",function(l){i=l;e()});$(a).bind("item-created",function(l,m){$(".k-kit-items-none",j).remove();c($("tbody",j),m)});$(a).bind("item-updated",function(m,n,l){d(l,n)});$(a).bind("item-deleted",function(l,m){if(!$("tbody tr",j).length){$("tbody",j).append(b)}})};return g.pub}})(Kitify);