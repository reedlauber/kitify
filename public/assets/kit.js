(function(a){a.KitTitle=function(d){var c=a.Component({id:"kit-title"},d);var g,b,f,h;function e(){b.click(function(){g.hide();f.show();h.val(g.attr("data-val")).focus()});h.blur(function(){var i=h.val();if(i){b.text(i);g.attr("data-val",i)}g.show();f.hide()})}c.oninit=function(){g=$(".k-kit-title-label");f=$(".k-kit-title-input");b=$(".k-kit-title-label h1");h=$("input",f);e()};return c.pub}})(Kitify);(function(a){a.NewItem=function(d){var c=a.Component({id:"newitem",fields:[{id:"newitem-name",prop:"name",required:true},{id:"newitem-quantity",prop:"quantity",required:true},{id:"newitem-merchanturl",prop:"merchant_url",required:true},{id:"newitem-price",prop:"price",required:true},{id:"newitem-notes",prop:"notes"}]},d);var b=/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;a.Form.validators["newitem-merchanturl"]=function(e,g,f){if(!b.test(g)){a.Form.addValidationMsg("<strong>Merchant Link</strong> is not a valid URL.");return false}return true};a.Form.validators["newitem-quantity"]=function(g,h,f){var e=parseInt(h,10);if(!$.isNumeric(e)){a.Form.addValidationMsg("<strong>Quantity</strong> must be a number.");return false}if(h<=0){a.Form.addValidationMsg("<strong>Quantity</strong> must be a positive number.");return false}f[g.prop]=e;return true};a.Form.validators["newitem-price"]=function(g,h,f){var e=parseFloat(h);if(!$.isNumeric(e)){a.Form.addValidationMsg("<strong>Price</strong> must be a numeric amount.");return false}if(e<0){a.Form.addValidationMsg("<strong>Price</strong> must be a positive numeric amount.");return false}f[g.prop]=e;return true};c.oninit=function(){var e=$("#kit").attr("data-id");var f=a.Form.setup({context:"#newitem",fields:c.options.fields,btns:{submit:"#kit-add-btn"}});$(f).bind("submit",function(g,h){h.slug=e;a.Data.save("/items",h,function(i){f.reset();$(a).trigger("item-created",[i])})})};return c.pub}})(Kitify);(function(a){a.EditItem=function(f){var c=a.Component({id:"edititem",fields:[{id:"item-name",prop:"name",required:true},{id:"item-quantity",prop:"quantity",required:true},{id:"item-merchanturl",prop:"merchant_url",required:true},{id:"item-price",prop:"price",required:true},{id:"item-notes",prop:"notes"}]},f);var e,g;var b=['<tr class="k-items-editrow">','<td><input type="text" id="item-name" value="{{name}}" class="span3" required /></td>','<td><input type="number" id="item-quantity" value="{{quantity}}" class="span1" required /></td>','<td><input type="url" id="item-merchanturl" value="{{merchant_url}}" class="span4" required /></td>',"<td>",'<div class="input-prepend">','<span class="add-on">$</span>','<input type="number" id="item-price" value="{{price}}" class="span2" required />',"</div>","</td>","<td>",'<div class="k-kit-items-anchor">','<input type="text" id="item-notes" value="{{notes}}" class="span4" />','<div id="kit-items-savectrls" class="k-kit-ctrls k-corner-right">','<a href="javascript:void(0)" class="k-kit-ctrls-save btn small primary">save</a>','<a href="javascript:void(0)" class="k-kit-ctrls-cancel btn small">cancel</a>',"</div>","</div","</td>","</tr>"].join("");function d(h){var k=h.data("item");if(k){var i=a.template(b,k);var m=$(a.template(b,k)).insertAfter(h.hide());var l=$("#kit-items-savectrls").show();var j=a.Form.setup({context:m,fields:c.options.fields,data:k,btns:{submit:".k-kit-ctrls-save"}});$(j).bind("submit",function(n,o){a.Data.save("/items/"+o.id,o,function(p){if(p&&p.success!==false){m.remove();$(a).trigger("item-updated",[p,h])}})});$(".k-kit-ctrls-cancel",l).click(function(){h.show();m.remove()})}}c.oninit=function(){e=$("#kit-items");g=$("#kit-items-editctrls");$(document).on("hover","#kit-items tbody tr",function(h){if(!$(this).hasClass("k-items-editrow")){if(h.type==="mouseenter"){g.appendTo($(".k-kit-items-anchor",this)).show()}else{g.hide()}}});$(".k-kit-ctrls-edit",g).click(function(){var h=$(this).parents("tr");if(h.length){d(h)}});$(".k-kit-ctrls-delete",g).click(function(){g.hide();var h=$(this).parents("tr");var i=h.attr("data-id");if(i){a.Data.del("/items/"+i,function(j){h.fadeOut(function(){g.appendTo("#kit");h.remove();$(a).trigger("item-deleted",[j.id])})})}})};return c.pub}})(Kitify);(function(a){a.Kit=function(k){var g=a.Component({id:"kit",components:{}},k),i=[];var j;var b='<tr class="k-kit-items-none"><td colspan="5">Start adding items above.</td></tr>';var h=['<tr data-id="{{id}}">','<td class="k-kit-items-name">{{name}}</td>',"<td>{{quantity}}</td>",'<td class="k-kit-items-url"><a href="{{merchant_url}}" target="_blank">{{merchant_url}}</a></td>',"<td>{{price}}</td>",'<td><div class="k-kit-items-anchor">{{notes}}</div></td>',"</tr>"].join("");function f(l){var m=$.extend(true,{},l);if(typeof l.price==="number"){m.price="$"+l.price.toFixed(2)}return m}function c(l,m){var n=f(m),o=a.template(h,n);$(o).appendTo(l).data("item",m)}function d(l,m){var n=f(m),o=a.template(h,n);l.replaceWith($(o).data("item",m))}function e(){var l=$("tbody",j).empty();if(!i.length){$("tbody",j).append(b)}else{$.each(i,function(m,n){n.price=parseFloat(n.price);c(l,n)})}}g.oninit=function(){g.pub.slug=$("#"+g.options.id).attr("data-id");j=$("#"+g.options.id+"-items");if($("#"+g.options.id).hasClass("editable")){$.each(g.options.components,function(l,m){m.init(g.pub)})}a.Data.get("/"+g.pub.slug+"/items",function(l){i=l;e()});$(a).bind("item-created",function(l,m){$(".k-kit-items-none",j).remove();c($("tbody",j),m)});$(a).bind("item-updated",function(m,n,l){d(l,n)});$(a).bind("item-deleted",function(l,m){if(!$("tbody tr",j).length){$("tbody",j).append(b)}})};return g.pub}})(Kitify);